<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="bower_components/bootstrap/dist/css/bootstrap-theme.css" rel="stylesheet" />
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jqueryui/jquery-ui.min.js"></script>
    <script src="bower_components/knockout/dist/knockout.js"></script>
    <script src="bower_components/knockout-sortable/build/knockout-sortable.js"></script>
    <style>
        .draggable-list-item {
            cursor: pointer;
            z-index: 1001;
        }

        .drop-list-group {
            padding: 50px;
            background-color: #808080;
        }
    </style>
</head>
<body>
    <div class="row">
        <div class="col-md-2">
            <div class="panel panel-default">
                <div class="panel-heading"><span class="panel-title">Available Sections</span></div>
                <div class="panel-body">
                    <ul data-bind="foreach: availableSections" class="list-group">
                        <li class="list-group-item draggable-list-item" data-bind="draggable: $data"><span data-bind="text: title"></span></li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="col-md-10">
            <div class="panel panel-success">
                <div class="panel-heading"><h3 class="panel-title">Selected Sections</h3></div>
                <div class="panel-body">
                    <ul id="selectedSections" data-bind="sortable: { data: selectedSections, beforeMove: beforeMove, dragged: itemDragged}" class="list-group drop-list-group" style="margin: 5px; padding: 5px;">
                        <li class="list-group-item">
                            <span data-bind="text: title"></span>
                            <button data-bind="visible: editable, click: $root.editItem">edit</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-text" class="modal fade" data-bind="with: editingSetion">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" data-bind="text: title, visible: canChangeTitle() == false"></h4>
                    <input type="text" class="form-control" data-bind="visible: canChangeTitle, value: title" />
                </div>
                <div class="modal-body">
                    <textarea class="form-control" data-bind="value: sectionData"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <div id="modal-selection" class="modal fade" data-bind="with: editingSetion">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" data-bind="text: title, visible: canChangeTitle() == false"></h4>
                    <input type="text" data-bind="visible: canChangeTitle, value: title" />
                </div>
                <div class="modal-body">
                    <input type="checkbox"  value="Item 1" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <pre data-bind="text: ko.toJSON($root, null, 2)"></pre>

    <script>

        function SectionViewModel(title, editor, canChangeTitle, sectionData) {
            if (canChangeTitle == null)
                canChangeTitle = false;

            this.title = ko.observable(title);
            this.editor = editor;
            this.editable = editor != null;
            this.sectionData = ko.observable(sectionData);
            this.canChangeTitle = ko.observable(canChangeTitle);
        }

        function DocViewModel() {
            var self = this;

            this.availableSections = ko.observableArray([
              new SectionViewModel('Publications'),
              new SectionViewModel('Honors'),
              new SectionViewModel('Education'),
              new SectionViewModel('Text Section', 'text', true, 'default text'),
              new SectionViewModel('Selected Pubs', 'selection')              
            ]);

            this.selectedSections = ko.observableArray([]);

            this.editingSetion = ko.observable();

            this.beforeMove = function (item, e, ui) {
                item.cancelDrop = true;

                var newItem = new SectionViewModel(item.item.title(), item.item.editor, item.item.canChangeTitle(), item.item.sectionData());
                self.selectedSections.push(newItem);

            }

            this.itemDragged = function (item, e, ui) {
                return $(item).clone();
            };

            this.editItem = function (item) {
                console.log(item.editor);

                self.editingSetion(item);

                $('#modal-' + item.editor).modal('show');
            };

        }

        var viewModel = new DocViewModel();

        ko.applyBindings(viewModel);
    </script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
</body>

</html>
